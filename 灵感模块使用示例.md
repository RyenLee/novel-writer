# 灵感模块使用指南

## 功能概述
灵感模块为小说写作工具提供了记录和管理写作过程中出现的点子、思路和想法的功能。

## 核心功能

### 1. 灵感记录
- **标题和内容**：记录灵感的主题和详细描述
- **标签管理**：为灵感添加标签，方便分类和搜索
- **置顶功能**：重要灵感可以置顶显示
- **章节关联**：将灵感与具体章节关联

### 2. 搜索和筛选
- **全文搜索**：在标题和内容中搜索关键词
- **标签筛选**：按标签筛选相关灵感
- **时间排序**：按创建时间或更新时间排序
- **置顶优先**：置顶灵感始终显示在最前面

## 数据库表结构

### inspirations 表
```sql
CREATE TABLE IF NOT EXISTS inspirations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    novel_id INTEGER NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL,
    is_pinned BOOLEAN DEFAULT 0,
    FOREIGN KEY (novel_id) REFERENCES novels(id) ON DELETE CASCADE
);
```

### inspiration_tags 表
```sql
CREATE TABLE IF NOT EXISTS inspiration_tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    inspiration_id INTEGER NOT NULL,
    tag TEXT NOT NULL,
    FOREIGN KEY (inspiration_id) REFERENCES inspirations(id) ON DELETE CASCADE,
    UNIQUE(inspiration_id, tag)
);
```

### inspiration_chapter_links 表
```sql
CREATE TABLE IF NOT EXISTS inspiration_chapter_links (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    inspiration_id INTEGER NOT NULL,
    chapter_id INTEGER NOT NULL,
    FOREIGN KEY (inspiration_id) REFERENCES inspirations(id) ON DELETE CASCADE,
    FOREIGN KEY (chapter_id) REFERENCES chapters(id) ON DELETE CASCADE,
    UNIQUE(inspiration_id, chapter_id)
);
```

## API 使用方法

### 创建灵感
```rust
use crate::db;

let db = db::get_database()?;
let inspiration = db.create_inspiration(
    1,  // novel_id
    "角色设定想法", 
    "主角应该有一个神秘的过去..."
)?;
```

### 获取小说所有灵感
```rust
let inspirations = db.get_inspirations_by_novel(1)?;
```

### 搜索灵感
```rust
let results = db.search_inspirations(1, "神秘")?;
```

### 更新灵感
```rust
db.update_inspiration(1, "新的标题", "更新后的内容")?;
```

### 添加标签
```rust
let tags = vec!["角色".to_string(), "设定".to_string()];
db.add_inspiration_tags(1, &tags)?;
```

### 关联章节
```rust
db.link_inspiration_to_chapter(1, 5)?; // 灵感ID 1 关联章节ID 5
```

## 数据结构

### Inspiration 结构体
```rust
#[derive(Debug, Serialize, Deserialize, Clone)]
pub struct Inspiration {
    pub id: i64,
    pub novel_id: i64,
    pub title: String,
    pub content: String,
    pub created_at: String,
    pub updated_at: String,
    pub is_pinned: bool,
    pub tags: Vec<String>,
    pub linked_chapters: Vec<i64>,
}
```

## 使用示例

### 完整的灵感管理流程
```rust
use crate::db;

fn manage_inspirations() -> Result<()> {
    let db = db::get_database()?;
    
    // 1. 创建新灵感
    let inspiration = db.create_inspiration(
        1,
        "情节转折点想法",
        "在第10章加入一个意想不到的反转..."
    )?;
    
    // 2. 添加标签
    db.add_inspiration_tags(inspiration.id, &[
        "情节".to_string(),
        "转折".to_string()
    ])?;
    
    // 3. 关联到章节
    db.link_inspiration_to_chapter(inspiration.id, 10)?;
    
    // 4. 置顶重要灵感
    db.toggle_inspiration_pin(inspiration.id)?;
    
    // 5. 搜索相关灵感
    let related = db.search_inspirations(1, "转折")?;
    
    Ok(())
}
```

## 集成建议

### UI 集成点
1. **侧边栏**：添加灵感面板标签页
2. **章节编辑器**：显示关联的灵感
3. **搜索功能**：集成到全局搜索中
4. **快捷操作**：一键创建当前章节相关的灵感

### 工作流程
1. **写作时记录**：在写作过程中随时记录想法
2. **整理归类**：为灵感添加标签和关联章节
3. **回顾应用**：在相关章节写作时参考对应灵感
4. **持续优化**：根据写作进展更新和完善灵感

## 最佳实践

### 标签命名规范
- 使用简洁明了的标签名称
- 避免过于宽泛的标签
- 建立标签层级关系（如：角色/主角、情节/转折）

### 内容组织
- 每个灵感聚焦一个具体想法
- 内容描述要具体明确
- 及时更新过时的灵感内容

### 关联管理
- 一个灵感可以关联多个章节
- 章节可以关联多个灵感
- 定期清理无效的关联关系

这个灵感模块为小说创作提供了强大的思路管理工具，帮助作者更好地组织和利用创作过程中的各种想法。